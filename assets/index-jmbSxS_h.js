(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const m of a.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&n(m)}).observe(document,{childList:!0,subtree:!0});function o(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(i){if(i.ep)return;i.ep=!0;const a=o(i);fetch(i.href,a)}})();const I=[{id:"happy",emoji:"üòä",label:"Happy",desc:"Joyful & bright",color:"#f5c842",quoteTag:"happiness",musicQuery:"happy upbeat pop"},{id:"calm",emoji:"üåø",label:"Calm",desc:"Peaceful & still",color:"#6db58e",quoteTag:"peace",musicQuery:"chill lofi ambient"},{id:"sad",emoji:"üåßÔ∏è",label:"Sad",desc:"Heavy & tender",color:"#7da8d4",quoteTag:"inspirational",musicQuery:"sad emotional ballad"},{id:"anxious",emoji:"üåÄ",label:"Anxious",desc:"Unsettled & tense",color:"#c4775a",quoteTag:"courage",musicQuery:"calming meditation relaxing"},{id:"motivated",emoji:"üî•",label:"Motivated",desc:"Driven & focused",color:"#e07b39",quoteTag:"motivational",musicQuery:"motivational workout energy"},{id:"nostalgic",emoji:"üçÇ",label:"Nostalgic",desc:"Reflective & warm",color:"#c49a5a",quoteTag:"life",musicQuery:"nostalgic retro indie folk"},{id:"tired",emoji:"üåô",label:"Tired",desc:"Weary & soft",color:"#9b8ac4",quoteTag:"rest",musicQuery:"sleep relaxing acoustic soft"},{id:"grateful",emoji:"üå∏",label:"Grateful",desc:"Thankful & open",color:"#d47ba3",quoteTag:"gratitude",musicQuery:"grateful acoustic soulful"}];function T(e,t){e.innerHTML="",I.forEach(o=>{const n=document.createElement("button");n.className="mood-card",n.setAttribute("data-mood-id",o.id),n.setAttribute("aria-label",`Select mood: ${o.label}`),n.style.setProperty("--mood-color",o.color),n.innerHTML=`
      <span class="mood-emoji" aria-hidden="true">${o.emoji}</span>
      <span class="mood-label">${o.label}</span>
      <span class="mood-desc">${o.desc}</span>
    `,n.addEventListener("click",()=>{t(o)}),e.appendChild(n)})}const S="https://api.api-ninjas.com/v1/quotes",k="qhNv8RLHdTus0JacHqRGPg==vGXhuJGrnE5Vbo8s",g={happiness:[{content:"Happiness is not something ready-made. It comes from your own actions.",author:"Dalai Lama"},{content:"The most important thing is to enjoy your life‚Äîto be happy‚Äîit's all that matters.",author:"Audrey Hepburn"}],peace:[{content:"Do not let the behavior of others destroy your inner peace.",author:"Dalai Lama"},{content:"Peace comes from within. Do not seek it without.",author:"Buddha"}],inspirational:[{content:"Even the darkest night will end and the sun will rise.",author:"Victor Hugo"},{content:"Believe you can and you're halfway there.",author:"Theodore Roosevelt"}],courage:[{content:"Breathe. It's just a bad day, not a bad life.",author:"Unknown"},{content:"You are braver than you believe, stronger than you seem, and smarter than you think.",author:"A.A. Milne"}],motivational:[{content:"The secret of getting ahead is getting started.",author:"Mark Twain"},{content:"Don't watch the clock; do what it does. Keep going.",author:"Sam Levenson"}],life:[{content:"In the end, it's not the years in your life that count. It's the life in your years.",author:"Abraham Lincoln"},{content:"Life is what happens when you're busy making other plans.",author:"John Lennon"}],rest:[{content:"Almost everything will work again if you unplug it for a few minutes, including you.",author:"Anne Lamott"},{content:"Rest when you're weary. Refresh and renew yourself.",author:"Ralph Marston"}],gratitude:[{content:"Gratitude turns what we have into enough.",author:"Melody Beattie"},{content:"Enjoy the little things, for one day you may look back and realize they were the big things.",author:"Robert Brault"}]};async function q(e){try{const t=await fetch(`${S}?category=${e}`,{headers:{"X-Api-Key":k},signal:AbortSignal.timeout(5e3)});if(!t.ok)throw new Error(`HTTP ${t.status}`);const o=await t.json();if(o&&o[0])return{content:o[0].quote,author:o[0].author};throw new Error("No quote returned")}catch(t){console.warn("Quotes API failed, using fallback:",t.message);const o=g[e]??g.inspirational;return o[Math.floor(Math.random()*o.length)]}}const A="https://itunes.apple.com/search",M=[{id:1,title:"Weightless",artist:"Marconi Union",album:"Weightless",cover:"",preview:"",duration:479},{id:2,title:"Clair de Lune",artist:"Claude Debussy",album:"Piano Works",cover:"",preview:"",duration:302},{id:3,title:"River Flows in You",artist:"Yiruma",album:"First Love",cover:"",preview:"",duration:214},{id:4,title:"Sunset Lover",artist:"Petit Biscuit",album:"Petit Biscuit",cover:"",preview:"",duration:213},{id:5,title:"Bloom",artist:"ODESZA",album:"Summer's Gone",cover:"",preview:"",duration:261}];async function $(e){var t;try{const o=`${A}?term=${encodeURIComponent(e)}&media=music&entity=song&limit=5`,n=await fetch(o,{signal:AbortSignal.timeout(8e3)});if(!n.ok)throw new Error(`HTTP ${n.status}`);const i=await n.json();if(!((t=i.results)!=null&&t.length))throw new Error("No tracks returned");return i.results.slice(0,5).map(a=>({id:a.trackId,title:a.trackName,artist:a.artistName,album:a.collectionName||"",cover:a.artworkUrl100||"",preview:a.previewUrl||"",duration:Math.floor((a.trackTimeMillis||0)/1e3)}))}catch(o){return console.warn("Music API unavailable, using fallback:",o.message),M}}function C(e){return e?`${Math.floor(e/60)}:${String(e%60).padStart(2,"0")}`:""}const h="moodwave_favorites";function d(){try{return JSON.parse(localStorage.getItem(h))||[]}catch{return[]}}function E(e){const t=d();return t.some(n=>n.type===e.type&&JSON.stringify(n.data)===JSON.stringify(e.data))?!1:(t.unshift({...e,savedAt:Date.now()}),localStorage.setItem(h,JSON.stringify(t)),!0)}function Q(e){const t=d();t.splice(e,1),localStorage.setItem(h,JSON.stringify(t))}function P(){return d().length}let f=null;function l(e,t=2800){const o=document.getElementById("toast");o&&(f&&clearTimeout(f),o.textContent=e,o.classList.add("show"),f=setTimeout(()=>o.classList.remove("show"),t))}function v(e){document.querySelectorAll(".screen").forEach(o=>o.classList.remove("active"));const t=document.getElementById(e);t&&(t.classList.add("active"),window.scrollTo({top:0,behavior:"smooth"}))}function x(e){const t=document.getElementById("moodBadge");t&&(t.innerHTML=`<span aria-hidden="true">${e.emoji}</span> ${e.label}`,t.style.background=`${e.color}22`,t.style.color=e.color)}function N(){document.getElementById("quoteLoading").style.display="flex",document.getElementById("quoteContent").hidden=!0,document.getElementById("quoteError").hidden=!0}function H(e){document.getElementById("quoteLoading").style.display="none",document.getElementById("quoteError").hidden=!0,document.getElementById("quoteText").textContent=e.content,document.getElementById("quoteAuthor").textContent=e.author;const t=document.getElementById("saveQuoteBtn");t.textContent="‚ô• Save",t.classList.remove("saved"),t.onclick=()=>{E({type:"quote",data:e})?(t.textContent="‚ô• Saved!",t.classList.add("saved"),u(),l("Quote saved to favorites ‚ô•")):l("Already in your favorites!")},document.getElementById("quoteContent").hidden=!1}function j(){document.getElementById("quoteLoading").style.display="none",document.getElementById("quoteContent").hidden=!0,document.getElementById("quoteError").hidden=!1}let r=null;function O(){document.getElementById("musicLoading").style.display="flex",document.getElementById("tracksList").hidden=!0,document.getElementById("musicError").hidden=!0}function D(e){document.getElementById("musicLoading").style.display="none",document.getElementById("musicError").hidden=!0;const t=document.getElementById("tracksList");if(t.innerHTML="",!(e!=null&&e.length)){t.innerHTML='<p class="loading-state">No tracks found for this mood.</p>',t.hidden=!1;return}e.forEach(o=>{const n=document.createElement("div");n.className="track-item";const i=o.cover?`<img class="track-cover" src="${o.cover}" alt="${s(o.title)} cover" loading="lazy">`:'<div class="track-cover-placeholder" aria-hidden="true">‚ô™</div>';n.innerHTML=`
      ${i}
      <div class="track-info">
        <div class="track-title">${s(o.title)}</div>
        <div class="track-artist">${s(o.artist)}${o.album?" ¬∑ "+s(o.album):""}${o.duration?" ¬∑ "+C(o.duration):""}</div>
      </div>
      <div class="track-actions">
        ${o.preview?`<button class="btn-play" aria-label="Play preview of ${s(o.title)}" title="Play 30s preview">‚ñ∂</button>`:""}
        <button class="btn-track-save" aria-label="Save ${s(o.title)}" title="Save to favorites">‚ô•</button>
      </div>
    `,o.preview&&n.querySelector(".btn-play").addEventListener("click",a=>F(o,a.currentTarget)),n.querySelector(".btn-track-save").addEventListener("click",a=>{E({type:"track",data:o})?(a.currentTarget.style.color="var(--accent)",u(),l(`"${o.title}" saved ‚ô•`)):l("Already in your favorites!")}),t.appendChild(n)}),t.hidden=!1}function F(e,t){r&&r.src!==e.preview&&(r.pause(),document.querySelectorAll(".btn-play").forEach(o=>o.textContent="‚ñ∂")),(!r||r.src!==e.preview)&&(r=new Audio(e.preview),r.addEventListener("ended",()=>t.textContent="‚ñ∂")),r.paused?(r.play().catch(()=>l("Could not play preview")),t.textContent="‚è∏"):(r.pause(),t.textContent="‚ñ∂")}function w(){r&&(r.pause(),r=null,document.querySelectorAll(".btn-play").forEach(e=>e.textContent="‚ñ∂"))}function R(){document.getElementById("musicLoading").style.display="none",document.getElementById("tracksList").hidden=!0,document.getElementById("musicError").hidden=!1}function L(){const e=document.getElementById("favoritesList"),t=document.getElementById("emptyFavorites"),o=d();if(e.innerHTML="",!o.length){t.hidden=!1;return}t.hidden=!0,o.forEach((n,i)=>{const a=document.createElement("div");a.className="fav-item",n.type==="quote"?a.innerHTML=`
        <div>
          <div class="fav-type">Quote</div>
          <div class="fav-text">"${s(n.data.content)}"</div>
          <div class="fav-sub">‚Äî ${s(n.data.author)}</div>
        </div>
        <button class="btn-fav-remove" aria-label="Remove from favorites">‚úï</button>
      `:a.innerHTML=`
        <div>
          <div class="fav-type">Track</div>
          <div class="fav-text">${s(n.data.title)}</div>
          <div class="fav-sub">${s(n.data.artist)}</div>
        </div>
        <button class="btn-fav-remove" aria-label="Remove from favorites">‚úï</button>
      `,a.querySelector(".btn-fav-remove").addEventListener("click",()=>{Q(i),u(),L(),l("Removed from favorites")}),e.appendChild(a)})}function u(){const e=document.getElementById("favCount");e&&(e.textContent=P())}function s(e){return String(e||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}let c=null;function _(){T(document.getElementById("moodGrid"),J),u(),document.getElementById("backBtn").addEventListener("click",p),document.getElementById("closeFavBtn").addEventListener("click",p),document.getElementById("favoritesBtn").addEventListener("click",U),document.getElementById("refreshQuoteBtn").addEventListener("click",()=>{c&&y(c)}),document.getElementById("retryQuoteBtn").addEventListener("click",()=>{c&&y(c)}),document.getElementById("retryMusicBtn").addEventListener("click",()=>{c&&B(c)})}function J(e){c=e,x(e),v("resultsScreen"),y(e),B(e)}async function y(e){N();try{const t=await q(e.quoteTag);H(t)}catch{j()}}async function B(e){O();try{const t=await $(e.musicQuery);D(t)}catch{R()}}function p(){w();const e=document.getElementById("favoritesScreen").classList.contains("active");v(e&&c?"resultsScreen":"moodScreen")}function U(){w(),L(),v("favoritesScreen")}_();var b;(b=document.getElementById("darkModeToggle"))==null||b.addEventListener("click",()=>{document.body.classList.toggle("dark-mode");const e=document.body.classList.contains("dark-mode");localStorage.setItem("darkMode",e),showToast(e?"üåô Dark mode enabled":"‚òÄÔ∏è Light mode enabled")});localStorage.getItem("darkMode")==="true"&&document.body.classList.add("dark-mode");
